= WAMAS 5 - Secure Communication

WAMAS has the ability to use SSL/TLS to encrypt internal Communication between Processes and Systems.
Transport Layer Security (TLS), and its now-deprecated predecessor, Secure Sockets Layer (SSL) are cryptographic protocols designed to provide communications security over a computer network. Several versions of the protocols find widespread use in applications such as web browsing, email, instant messaging, and voice over IP (VoIP). Websites can use TLS to secure all communications between their servers and web browsers.

With the implementation of the request https://polarion.wamas.com/polarion/#/project/W5_Backlogs/workitem?id=WP-26031[WP-26031] the following security aspects were added to WAMAS 5.

* Certificate Generation and Key Store Management within Settings Server
* Handling of external certificates
* Key Store Management for Server Processes and Clients
* Security Properties Configuration through DCS
* Tools which do not/cannot use Settings Server can bootstrap Key/Trust Stores themselves
* Secured Protocols
** ECF (incl. Mutual Authentication between Server and Client)
** JDBC
*** Oracle
*** MS SQL Server
*** PostgreSQL
** JMS
** REST

*External Tools:*

*Jasper Reports*

https://pwiki59.wamas.com/index.php/How_to_enable_SSL_for_JDBC_Datasource_on_Jasper_Server
https://pwiki59.wamas.com/index.php/How_to_enable_HTTPS_on_Jasper_Server

*RAP Server for Desktop/Mobile*

<<RAP>>

More protocols will be secured within the next releases.

== Concept

In WAMAS 5 we chose the concept to rely on the default JSSE java mechanism to provide security features.
In case that the security related configurations via system property are already set we continue with them otherwise we bootstrap it ourselves. The certificates we generate ourselves are valid for 100 years in order to ensure that they do not expire during the lifetime of an installation.

Once there is a proper CA infrastructure in place we should use certificates which expire in a rather short timespan.

Below the bootstraping process for the Key Store Management is depicted.

.Key Store Management for Server and Client
[plantuml, keystore-bootstraping, png]
....
@startuml
|Certificate Management Server|
start
partition "Bootstrap Root Certificates" {
if ("__Root Keystore__" exists) then (yes)
 :Load Root Key Pair;
 :Load Root Certificate;
else (no)
 :Generate Root Key Pair;
 :Generate self-signed Root Certificate;
 :save "__Root Keystore__";
endif

}

partition "Bootstrap Server Certificates" {
:create or update "__Service Keystore__";
}

partition "Bootstrap Client Truststore" {
:import external trusted certificates;
:create or update "__Client Truststore__";
}

partition "Serve" {
:Start HTTP File Server;
:serve "__Client Truststore__" for download;
:serve "__CSR Ressource__" for
 signing and certificate generation;
}
end

|#LightSteelBlue|Certificate Management Client|
start
if (Security enabled?) then (yes)

if (JSSE Properties set) then (yes)
else (no)

partition "Bootstrap Stores" {
:Download "__Client Truststore__";
:Create "__CSR__" and send it to
 Certificate Management Server;
:Create "__Service Keystore__" and
 store generated Certificate;
}

:load and decrypt "Store Password";

:set JSSE Properties;

endif
else (no)
endif

|#LightSteelBlue|Certificate Management Client|
stop
@enduml
....

=== Store Content Overview

Java uses two different kinds of Key Stores.

Key Store:: Store which contains keys and certificates of the "user". This store contains private key data and should therefore use an encrypted store format like PKCS#12.


Trust Store:: Store contains holds certificates with the "user" trusts.

.Wamas Store Content Concept
image::keystores.png[Wamas Store Content]

=== System Properties

The complete control over the SSL features is handled by system properties. These are in the IDE already predefined in the launch configurations and as _String Substitutions_.
For binary installation the needed system properties are set via the SDC Admin Console.

.WAMAS Security System Properties
[width="100%",frame="topbot",options="header,footer"]
|===
|System Property Name | Description | Notes
| wamas.security.enabled.jdbc | Defines whether encryption for JDBC based communication is activated or not. | Default value: *false*. This en-/disables *only* WAMAS internal handling. If JSSE properties are supplied these are most likely used anyway.

| wamas.security.enabled.jms | Defines whether encryption for JMS based communication is activated or not. | Default value: *true*. This en-/disables *only* WAMAS internal handling. If JSSE properties are supplied these are most likely used anyway.

| wamas.security.enabled.jmx | Defines whether encryption for JMX communication is activated or not. | Default value: *true*. This en-/disables *only* WAMAS internal handling. If JSSE properties are supplied these are most likely used anyway.

| wamas.security.enabled.http | Defines whether encryption for HTTP based communication is activated or not. | Default value: *true*. This en-/disables *only* WAMAS internal handling. If JSSE properties are supplied these are most likely used anyway.

| wamas.security.enabled.remoteLoggingSocketAppender | Defines whether encryption for remote-logging-socket-appender based communication is activated or not. | Default value: *false*. This en-/disables *only* WAMAS internal handling. If JSSE properties are supplied these are most likely used anyway.

| com.wamas.security.secret | _Encrypted_ password for keystore and truststore. Decryption will be done in the client or server process. | This needs to be configured in the deployment solution which than set this as system property for clients and server processes.

| com.wamas.security.provider.url | URL where clients and server processes can download the trustore files and can send the CSR to. eg: `*http://perftest07.wamas.com:21300*`| Truststore files are downloaded to to client or server using http downloads.

| com.wamas.security.trusted | Points to a Path where external certificates eg. for the database are stored. During *Settings Server* Bootstrap these will be read and added to the truststore. | This property is only relevant for the *Settings Server*

| com.wamas.security.certificate.hostname | if connection to server is established via DNS Alias and therefore hostname and CN of certificate differ set the hostname for validation explicitly. |  affects *MS SQL Server*.

| com.wamas.security.sqlserver.trust | Set true in order to trust any certificate provided by *MS SQL Server* without validating it. Setting this to true should only be used for test systems which do not have a certificate and therefore fallback to a generated self signed certificate. | affects only *MS SQL Server*.

| com.wamas.security.bootstrap.local | Set true in order to bootstrap the key/truststores locally loading externally trusted certificates. | This is intended only for tools which do not use the Settings Server, all other applications should bootstrap the stores from the settings server.
|===

.JSSE System Properties
[width="100%",frame="topbot",options="header,footer"]
|===
|System Property Name | Description | Notes

| javax.net.ssl.keyStore | Location of the Java keystore file containing an application process's own certificate and private key.| If not set it will be generated into the Platform Runtime Directory of the process. eg. `./bin/Message_Server/workspace/wamas_certs`

| javax.net.ssl.keyStorePassword | Password to access the private key from the keystore file specified by `javax.net.ssl.keyStore`. This password is used twice:

* To unlock the keystore file (store password), and

* To decrypt the private key stored in the keystore (key password).

In other words, the JSSE framework requires these passwords to be identical.| JSSE expects it to be provided as plain text. For WAMAS we use our own system property (_com.wamas.security.secret_) which is encrypted .

| javax.net.ssl.keyStoreType | _Optional_: For Java keystore file format, this property has the value jks (or JKS). You do not normally specify this property, because its default value is already jks.| We generally use and recommend using *`PKCS12`* for storing private keys.

| javax.net.ssl.trustStore |Location of the Java keystore file containing the collection of CA certificates trusted by this application process (trust store). | If not set it will be generated into the Platform Runtime Directory of the process. eg. `./bin/Message_Server/workspace/wamas_certs`

| javax.net.ssl.trustStorePassword |Password to unlock the keystore file (store password) specified by `javax.net.ssl.trustStore`. |JSSE expects it to be provided as plain text. For WAMAS we use our own system property (_com.wamas.security.secret_) which is encrypted.

| javax.net.ssl.trustStoreType | _Optional_: For Java keystore file format, this property has the value jks (or JKS). You do not normally specify this property, because its default value is already jks. | JKS is used and recommend for the trust store.

| javax.net.debug | _Optional_: can be used to debug SSL/TLS connections. eg. use `-Djavax.net.debug=all` to enable verbose debug output for SSL/TLS. | Only needed for debugging. When enabling this the complete SSL handshake and the network transfer as hex values are dumped to the default output stream, so be very careful with this.
|===

== Configuration

=== DCS

IMPORTANT: Starting with WAMAS Release 5.9 DCS (https://github.com/bdeployteam/bdeploy[DCS @ *GitHub*]) will be the used deployment solution.

.DCS Configuration
image::dcs_configuration.png[DCS Configuration]

. Boolean Flag to *enable / disable* SSL/TLS Usage. This is a _global_ switch which will affect *all* supported protocols. There is no way to switch this on protocol basis. The default value is *false*.
. Store Key Password which will be used for the Key Store and Trust Store. This is automatically encrypted analogous to the database password. This will be "forwarded" to server and client processes as encrypted String and will be decrypted locally.
. HTTP URL where the Key Management Clients can download the relevant key store and truststore files.

=== Eclipse

Security Properties in Eclipse are set in the launch configurations (LcDsl) files which refer to the values in the String Substitutions.

=== RAP

To enable HTTPS for RAP when started from the IDE the system properties area automatically used.
If RAP HTTP Security is enabled an additional ServerConnector will be added for testing, the normal
HTTP Server Connector will remain in place and can be used as well.

For a binary installation distinct configuration files are prepared and can be configured via DCS.

.RAP Security
image::dcs_rap_jetty_security.png[RAP Security]

* *Keystore* - Path to the Keystore which shall be used when serving https. This is an _optional_ argument and can be ignored for http.
* *Keystore Password* - obfuscated password for the Keystore. This is an _optional_ argument and can be ignored for http.

.RAP Program Arguments
image::dcs_rap_jetty_rap_args.png[RAP Program Arguments]

* *HTTP Server Port* - which shall be used. Depending on the selected Configuration file we server either http or https.
* *Rap Server Configuration* - Path to Jetty server configuration files. WAMAS provides to different configurations one configuration for http
(_jetty-http.xml_) and one for https (_jetty-https.xml_).

==== RAP prepare keystore

Use *_com.wamas.platform.jetty.JettyKeystoreAndPasswordGenerator_* to create a p12 Keystore from a given PEM File.

The PEM File needs to contain the KEY as well as the Certificate in order to be properly usable for HTTPS.

IMPORTANT: For productive use an official certificate should be used and must be provided by the customer.

*For Testing*

1. create key/certificate

`openssl req -newkey rsa:2048 -new -nodes -x509 -days 3650 -keyout key.pem -out cert.pem`

2. export plain RSA private key

`openssl rsa -in key.pem -out nopasskey.pem`

3. concat into single PEM

`cat nopasskey.pem > server.pem`
`cat cert.pem >> server.pem`

4. run *JettyKeystoreAndPasswordGenerator* to generate keystore and obfuscated pwd.
A Launch configuration *jetty-pwd-gen* is provided.

The tool logs the result in System.out from there the needed data can be copied to the DCS configuration.

.JettyKeystoreAndPasswordGenerator Example
----
Enter Password:
2ChangeIt4wamas

Enter Export Directory:
/tmp

Enter path to PEM File:
/tmp/server.pem

Keystore: /tmp/wamas-jetty-keystore.p12
Password: 2ChangeIt4wamas
Password (obfuscated): OBF:1lq61lk11v961ri71yeu1jua1w1c1i0v1w261jrg1yfc1ri71v9g1llp1lts
----

==== RAP HTTPS from IDE

NOTE: Currently testing HTTPS from IDE is not implemented on purpose because it might interfere with the binary setup as well.

In order to test this from the IDE a *Fragment* Bundle (`Fragment-Host: org.eclipse.equinox.http.jetty`) needs to be created with a *JettyCustomizer* to intercept
the Jetty Server Startup from the IDE and apply the proper customizations.
This bundle needs to be added to the launch configuration. Additionally several vm arguments also need to be added to make this work.

.VM Arguments for RAP LC for HTTPS Setup from IDE
----
//customize Jetty Server Connectors - https needs to be enabled, all connectors will be updated by provided customizer
vm-argument '-Dorg.eclipse.equinox.http.jetty.https.enabled=true';
vm-argument '-Dorg.eclipse.equinox.http.jetty.https.port=10443';
vm-argument '-Dorg.eclipse.equinox.http.jetty.ssl.keystore=/tmp/ignoreme.jks'; //will be ignored but needs to be set
vm-argument '-Dorg.eclipse.equinox.http.jetty.ssl.password=IgnoreMe'; //will be ignored but needs to be set
vm-argument '-Dorg.eclipse.equinox.http.jetty.ssl.keypassword=IgnoreMe'; //will be ignored but needs to be set
vm-argument '-Dorg.eclipse.equinox.http.jetty.customizer.class=com.wamas.platform.jetty.WamasJettyCustomizer';
vm-argument '-Dcom.wamas.security.enabled.rapHttp=true';
----


.Jetty Customizer
[source, java]
----

import java.util.Arrays;
import java.util.Dictionary;

import org.eclipse.equinox.http.jetty.JettyConstants;
import org.eclipse.equinox.http.jetty.JettyCustomizer;
import org.eclipse.equinox.http.jetty.internal.Details;
import org.eclipse.jetty.http.HttpVersion;
import org.eclipse.jetty.server.HttpConfiguration;
import org.eclipse.jetty.server.HttpConnectionFactory;
import org.eclipse.jetty.server.ServerConnector;
import org.eclipse.jetty.server.SslConnectionFactory;
import org.eclipse.jetty.util.ssl.SslContextFactory;

import com.wamas.platform.security.SecretProvider;
import com.wamas.platform.security.WamasKeyManagementClientService;
import com.wamas.platform.security.WamasSecurityContext;
import com.wamas.platform.security.WamasSslConsts;

public class WamasJettyCustomizer extends JettyCustomizer {

    @Override
    public Object customizeHttpsConnector(Object connector, Dictionary<String, ?> settings) {
        if (!Boolean.getBoolean("com.wamas.security.enabled.rapHttp")) {
            //If security is not enabled we simply delegate to original customizer
            return super.customizeHttpsConnector(connector, settings);
        } else if (connector == null && Boolean.getBoolean("com.wamas.security.enabled.rapHttp")) {
            throw new IllegalStateException("Unable to customize Server Connector due to null reference");
        }

        ServerConnector originalConnector = ((ServerConnector) connector);
        int port = Details.getInt(settings, JettyConstants.HTTPS_PORT, 80);

        WamasKeyManagementClientService.provider.getService();

        SslContextFactory sslContextFactory = new SslContextFactory();
        sslContextFactory.setKeyStorePath(WamasSecurityContext.getKeyStorePath());
        sslContextFactory.setKeyStorePassword(SecretProvider.getSecret());
        sslContextFactory.setKeyStoreType(WamasSslConsts.DEFAULT_KEYSTORE_TYPE);
        sslContextFactory.setTrustStorePath(WamasSecurityContext.getTrustStorePath());
        sslContextFactory.setTrustStorePassword(SecretProvider.getSecret());
        sslContextFactory.setTrustStoreType(WamasSslConsts.DEFAULT_TRUSTSTORE_TYPE);

        HttpConfiguration httpsConfiguration = new HttpConfiguration();
        httpsConfiguration.setSecureScheme(org.eclipse.jetty.util.URIUtil.HTTPS);
        httpsConfiguration.setSecurePort(port);

        SslConnectionFactory sslConnectionFactory = new SslConnectionFactory(sslContextFactory, HttpVersion.HTTP_1_1.asString());
        HttpConnectionFactory httpConnectionFactory = new HttpConnectionFactory(httpsConfiguration);

        originalConnector.setConnectionFactories(Arrays.asList(sslConnectionFactory, httpConnectionFactory));
        originalConnector.setPort(port);

        return originalConnector;

    }

}

----

=== WAMAS A Specials

For OneMFS / WAMAS A most of the properties are forwarded from the deployment services. In order to ensure that properties in the IDE are correctly set the following files need to be updated. WAMAS A supports different "deployment targets". This makes it possible to have different configurations for the application in the same repository and to switch between them easily. The deployment targets are located here: `/com.wamas.acx4.mfs/cfg/deploy`.

IMPORTANT: The properties which are configured in the following files can be overwritten by system properties.

TIP: For further information please refer to the http://acxlin.wamas.com:9090/job/acx58_nightly/lastSuccessfulBuild/artifact/mfs/com.wamas.acx4.mfs/build/asciidoc/html5/acx4.html#mandatory-mfs-java-coding[ACX Developer Documentation]

==== acxJpa.properties

WAMAS A uses the *acxJpa.properties* file to configure the JPA / Hibernate settings. This needs to be aligned with the DB settings of WAMAS 5.

==== installer.properties

WAMAS A uses the *installer.properties* file to configure properties which will be "installed" in the WAMAS A database and will be used by the WAMAS A Host Controller Process which will forward these to the forked child processes.
In case of enabled security the REST discovery URL property (`acx.installer.rest.w5.url`) needs to be updated to use *HTTPS* Scheme instead of simple *HTTP*. In case any property in this file is changed the *WAMAS A Install* launch configuration needs to be executed in order to ensure that the changed properties are installed correctly.

For WAMAS 5 also the `wamas.rest.external.discovery` needs to be set to *https* in case of enabled security.

=== Databases

IMPORTANT: Certificates for the Database are from WAMAS 5 perspective _external trusted certificates_. These need to be provided by the administrator of the Database. In case the  setup of the database is carried out by SSI we are responsible for generating the certificates as well. In case the customer provides the database he is also responsible for providing proper certificates.

==== Oracle
IMPORTANT: When using Oracle RAC we need to configure a proper TNS connecting String which specifies the used protocol. Either *TCP* or *TCPS*. This needs to be aligned with the System Property _com.wamas.security.enabled_. Simple _thin_ connect Strings will be converted to _TNS_ connect Strings on the fly.

IMPORTANT: Oracle supports only one protocol per port. Therefore a distinct Listener needs to be configured for *TCP* and *TCPS*.

==== MS SQL Server
MS SQL Server supports secure and insecure connections on the same port. It is possible to enforce secure connections from the server side.

There are two special system properies for MS SQL Server.

*com.wamas.security.certificate.hostname*: if connection to server is established via DNS Alias and therefore hostname and CN of certificate differ set the hostname for validation explicitly.

*com.wamas.security.sqlserver.trust*: Set *_true_* in order to trust any certificate provided by MS SQL Server without validating it. Setting this to true should only be used for test systems which do not have a certificate and therefore fallback to a generated self signed certificate.

==== PostgreSQL

PostgreSQL supports secure and insecure connections on the same port.

== Trusting WAMAS Instance

In case several WAMAS Products (eg. WAMAS 5 and LRM) should integrate with each other and each
product has its own settings server each instance needs to add the root certificate of the other instance
to its external trusted certificates folder.
The Certificate can be downloaded from the settings server via: `http://<hostname>:<port>/wca` (see: <<System Properties>> - `com.wamas.security.provider.url`) and needs to be put
into the folder for external certificates - see: <<System Properties>> - `com.wamas.security.trusted` *manually*.

== Performance Impact Report

=== Test Infrastructure

To measure the impact of SSL/TLS on WAMAS 5 we used the perftest07.wamas.com. On the one hand to check the plain technical impact and on the other the logistical impact. Technical performance tests were based on 5.8 and used a subset of the WAMAS 5 Server Assessment JMeter test cases. For the logistical test cases we merged the change to the Kohls project and used the projects performance tool chain.

==== Test Server | perftest07.wamas.com

====
*uname -a*

Linux perftest07.wamas.com 3.10.0-514.el7.x86_64 #1 SMP Wed Oct 19 11:24:13 EDT 2016 x86_64 x86_64 x86_64 GNU/Linux
====

====
*lscpu*
[%hardbreaks]
Architecture: x86_64
CPU op-mode(s): 32-bit, 64-bit
Byte Order: Little Endian
CPU(s): 88
On-line CPU(s) list: 0-87
Thread(s) per core: 2
Core(s) per socket: 22
Socket(s): 2
NUMA node(s): 2
Vendor ID: GenuineIntel
CPU family: 6
Model: 79
Model name: Intel(R) Xeon(R) CPU E5-2699 v4 @ 2.20GHz
Stepping: 1
CPU MHz: 2200.000
BogoMIPS: 4431.51
Virtualization: VT-x
L1d cache: 32K
L1i cache: 32K
L2 cache: 256K
L3 cache: 56320K
NUMA node0 CPU(s): 0-21,44-65
NUMA node1 CPU(s): 22-43,66-87
====

====
*egrep --color 'Mem|Cache|Swap' /proc/meminfo*
[%hardbreaks]
MemTotal: 263833112 kB
MemFree: 931604 kB
MemAvailable: 108748776 kB
Cached: 136920620 kB
SwapCached: 308 kB
SwapTotal: 4194300 kB
SwapFree: 4186876 kB
====

==== Test Server | salxtest17.wamas.com

====
*uname -a*

Linux salxtest17.wamas.com 3.10.0-693.el7.x86_64 #1 SMP Thu Jul 6 19:56:57 EDT 2017 x86_64 x86_64 x86_64 GNU/Linux
====

====
*Lscpu*
[%hardbreaks]
Architecture: x86_64
CPU op-mode(s): 32-bit, 64-bit
Byte Order: Little Endian
CPU(s): 88
On-line CPU(s) list: 0-87
Thread(s) per core: 2
Core(s) per socket: 22
Socket(s): 2
NUMA node(s): 2
Vendor ID: GenuineIntel
CPU family: 6
Model: 79
Model name: Intel(R) Xeon(R) CPU E5-2699 v4 @ 2.20GHz
Stepping: 1
CPU MHz: 2200.000
CPU max MHz: 2200.0000
CPU min MHz: 1200.0000
BogoMIPS: 4394.94
Virtualization: VT-x
L1d cache: 32K
L1i cache: 32K
L2 cache: 256K
L3 cache: 56320K
NUMA node0 CPU(s): 0-21,44-65
NUMA node1 CPU(s): 22-43,66-87
====

====
*egrep --color 'Mem|Cache|Swap' /proc/meminfo*
[%hardbreaks]
MemTotal: 263833808 kB
MemFree: 142087728 kB
MemAvailable: 227208852 kB
Cached: 104233512 kB
SwapCached: 1840 kB
SwapTotal: 8388604 kB
SwapFree: 8373572 kB
====

=== Technical Impact Tests

Technical impact tests used the salxtest17.wamas.com as test system. A MS SQL Server Database on the same machine was used as RDBMS. The Server Assessment JMeter tests have been executed locally on the server. 4 runs were made using 5.8 and 3 runs were made with the security changes applied.

==== Server Assessment | Simple CRUD Operation

The markers show the median of the datasets.

.Simple CRUD
image::perf_simple_crud.png[Simple CRUD Operation, image,width=672,height=372]

==== Server Assessment | CLOB CRUD Operations

The markers show the median of the datasets.

.CLOB CRUD
image::perf_clob_crud.png[CLOB CRUD Operation, image,width=672,height=328]

==== Server Assessment | Read 10.000 StoLoc Records

The markers show the median of the datasets.

.Read 10k StoLocs
image::perf_read_10k.png[Read 10k StoLocs, image,width=672,height=345]

==== Server Assessment | ECF Simple Application ID Lookup Service

The markers show the median of the datasets.

.Simple ECF Call
image::perf_simple_ecf.png[Simple ECF Service Call, image,width=672,height=371]

==== Summary

The results show that in general using SSL/TLS slows down the communication by several percent. Additionally, we can see that the results have a rather large variance which might be caused by server load, DB load or network. In general, we can say that the median percentage over the aggregated samples for JDBC is at **21.95%**. The median percentage of the 95 percentiles over the aggregated samples for JDBC is at **13.42%**.

For ECF the median percentage over the aggregated samples is at **17.26%**. The median percentage of the 95 percentiles over the aggregated samples for ECF is at **19.00%**.

.Technical Impact Tests Summary
[cols="^.^,^.^,^.^,^.^,^.^,^.^,^.^,^.^,^.^", width="100%",frame="topbot"]
|===
.2+^.^|*Test Case* 4+^.^|*Median* 4+^.^| *95 Percentile*
| *No SSL* | *SSL* | *Delta* | *%-Delta* | *No SSL* | *SSL* | *Delta* | *%-Delta*

v| Perf-DB-CRUD-SIMPLE-1 | 7938 | 9049 | 1111 | *14.00* | 9469 | 10393 | 924 | *9.76*

v| Perf-DB-CRUD-SIMPLE-2 | 7680 | 9567 | 1887 | *24.57* | 9744 | 11775 | 2031 | *20.84*

v| Perf-DB-CRUD-SIMPLE-5 | 7345 | 9037 | 1692 | *23.04* | 10007 | 11569 | 1562 | *15.61*

v| Perf-DB-CRUD-CLOB-1 | 9194 | 10928 | 1734 | *18.86* | 11221 | 12298 | 1077 | *9.60*

v| Perf-DB-CRUD-CLOB-2 | 9581 | 11810 | 2229 | *23.26* | 12769 | 15657 | 2888 | *22.62*

v| Perf-DB-CRUD-CLOB-5 | 9347 | 11712 | 2365 | *25.30* | 13306 | 16159 | 2853 | *21.44*

v| Perf-DB-READ-10K-1 | 90551 | 102036 | 11485 | *12.68* | 131467 | 125504 | _-5963_ | *_4.54_*

v| Perf-DB-READ-10K-2 | 87401 | 100837 | 13436 | *15.37* | 129842 | 131978 | 2136 | *1.65*

v| Perf-DB-READ-10K-5 | 90531 | 110406 | 19875 | *21.95* | 128380 | 145603 | 17223 | *13.42*

v| Perf-DB-ECF-1 | 1163 | 1300 | 137 | *11.78* | 1337 | 1548 | 211 | *15.78*

v| Perf-DB-ECF-2 | 1211 | 1420 | 209 | *17.26* | 1421 | 1691 | 270 | *19.00*

v| Perf-DB-ECF-5 | 1178 | 1497 | 319 | *27.08* | 1578 | 2027 | 449 | *28.45*
|===


=== Logistical Impact Tests
Logistical impact tests used the perftest07.wamas.com and a locally installed Oracle 12 instance as RDBMS. Test used a binary deployed version of the kohls software with and without the security changes.

For the logistical impact analysis, we chose several relevant system KPIs written by WAMAS itself using the OMD Database and the related Jasper Reports to evaluate them.

.WAMAS KPIs for logistical impact tests
[width="100%",frame="topbot",options="header"]
|===
|KPI |Protocol |Comments
|InSpmImp |JDBC (CLOB write) |Data Interface processing incoming telegrams and creating CLOB data records and normal entities.
|FogDemandBasedReplenishmentByPicking |JDBC (read) |Daemon which creates Replenishment LUs based on current demand. Once the demand is completely fulfilled the daemon still reads all relevant data to check if there is an open demand. Daemon is executed every 5 seconds.
|JM-ContinuousPickingTest-PICKUP |ECF, JDBC (read, write) |Measures the booking times for picking and all included actions. Picking is simulated using JMeter “robots”.
|===

==== KPI | InSpmImp

Sent 20.000 telegrams to the File Data Interface and measures the processing time. The numbers show the ms needed to process one telegram.

.DI Throughput without SSL
image::perf_logistics_di_no_ssl.png[DI Throughput without SSL, image,width=672,height=239]


.DI Throughput with SSL
image::perf_logistics_di_ssl.png[DI Throughput with SSL, image,width=672,height=235]

We can also see here that the average processing time is higher for SSL/TLS. The average without SSL/TLS is at 61 whereas the average with SSL/TLS is at 69 which is *13.11%* slower. When we look at the 99.9 percentile we can see that without SSL/TLS it is at 607 ms/telegram and with SSL/TLS it is at 540 ms/telegram. This means that for this test run SSL/TLS was faster than without SSL/TLS by **11.04%**. Again, we can see that other influences like server load, DB load or network also have a big or even bigger impact.


==== KPI | FogDemandBasedReplenishmentByPicking

Before starting the KPI evaluation for this KPI we ensured that the system is saturated and therefore focuses on data reads. For checking if a new replenishment load unit and related entities need to be created the daemon needs to read the actual demand and compare it to the already created replenishment load units. If there is no open demand, we only see the amount of time needed to load and compare the data sets.

.fog demand based replenishment by picking without SSL
image::perf_logistics_fog_based_repl_no_ssl.png[fog demand based replenishment by picking without SSL, image,width=672,height=230]

.fog demand based replenishment by picking with SSL
image::perf_logistics_fog_based_repl_ssl.png[fog demand based replenishment by picking without SSL, image,width=672,height=230]

The numbers here show the time it took for the daemon to complete one run. Our evaluation captures 47 runs without SSL/TLS and 48 with SSL/TLS. The average without SSL/TLS is 5084ms and with it is at 5144ms, this means a runtime increase of **1.18%**. Comparing the 90 percentiles, without SSL/TLS it is at 5361ms and with SSL/TLS it is at 5412, which is a runtime increase of **0.95%**.

==== KPI | JM-ContinuousPickingTest-PICKUP

Picking was simulated using JMeter “robots” to act as pickers. The curve should show a constant line if there are enough orders to work on. Once the system is drained from orders the curve will start to decrease.

The number shown represent the time to complete one pick and perform all the relevant tasks and write all changes to DB. We chose a snapshot of the picking simulation to have a representative number of 8578 picks for each test.


.Picking without SSL
image::perf_logistics_picking_no_ssl.png[Picking without SSL, image,width=672,height=230]

.Picking with SSL
image::perf_logistics_picking_ssl.png[Picking with SSL, image,width=672,height=230]

The average time it took for one pick to complete is at 147ms without SSL/TLS and at 131ms with SSL/TLS, this is a percental difference of *10.88%* whereas SSL/TLS was **faster**. Again, this indicates that some other system related influences are having a big impact on the processing time.

Comparing the 99.9 percentiles, without SSL/TLS it took 995ms and with SSL/TLS it took 534ms, which is *46.33%* faster.

=== Summary

The logistical impact tests show a result similar to that of the technical impact tests.

In general, we can conclude that a realistic impact is between 10 and 20 percent, but the tests also show a very large deviation in their results, so that we must state here that other influences like system load, DB load or network might have a bigger effect than SSL/TLS.

Especially pointing out those tests cases where SSL/TLS was faster than without SSL/TLS.